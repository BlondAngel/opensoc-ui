#!/bin/bash

src="${BASH_SOURCE[0]}"
while [ -h "$src" ]; do
  bindir="$( cd -P "$( dirname "$src" )" && pwd )"
  src="$(readlink "$src")"
  [[ $src != /* ]] && src="$bindir/$src"
done

bindir="$( cd -P "$( dirname "$src" )" && pwd )"
root=`dirname "$bindir"`

forever="$root/node_modules/forever/bin/forever"


if [ $# -lt 1 ]
then
    echo "Usage: $0 start|restart|stop|serve"
    exit
fi


case "$1" in

serve)
    echo  "Starting test server. Exit with Ctrl+C."
    NODE_ENV=production node $root/server.js
   ;;
*)
    NODE_ENV=production $forever $1 ${*:2} \
        --spinSleepTime 1000 --minUptime 5000 \
        $root/server.js
   ;;
esac
